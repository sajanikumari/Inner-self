<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InnerSelf Buddy - Smart Reminders</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Comic Neue', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f9d2cc, #f5cac3);
            min-height: 100vh;
            color: #5D2906;
        }

        /* Navigation Bar */
        .navbar {
            height: 70px;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255, 182, 193, 0.4);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: #ffb6c1;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            color: #8b4513;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .logo-text {
            font-size: 24px;
            font-weight: bold;
            color: #8b4513;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .nav-links {
            display: flex;
            gap: 25px;
        }

        .nav-links a {
            text-decoration: none;
            color: #8b4513;
            font-weight: 500;
            font-size: 18px;
            padding: 8px 12px;
            border-radius: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-links a:hover, .nav-links a.active {
            background: rgba(255, 182, 193, 0.3);
        }

        .nav-links a::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: #ff69b4;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .nav-links a:hover::after, .nav-links a.active::after {
            width: 100%;
        }

        /* Error Message Styles */
        .error-message {
            font-size: 14px;
            border-radius: 20px !important;
        }

        .error-message.error {
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: 2px solid #dc3545;
        }

        .error-message.warning {
            background: rgba(255, 193, 7, 0.9);
            color: #5D2906;
            border: 2px solid #ffc107;
        }

        .error-message.success {
            background: rgba(40, 167, 69, 0.9);
            color: white;
            border: 2px solid #28a745;
        }

        /* Reminders Container */
        .reminders-container {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 30px auto;
            max-width: 1000px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 2px solid #ffd1dc;
        }

        .reminders-container h2 {
            color: #8B4513;
            text-align: center;
            margin-bottom: 30px;
            font-size: 32px;
            position: relative;
            padding-bottom: 15px;
        }

        .reminders-container h2:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(to right, #ffb6c1, #ff69b4);
            border-radius: 2px;
        }

        /* Create Reminder Form */
        .create-reminder {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border: 2px solid #ffb6c1;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #5D2906;
            font-weight: bold;
            font-size: 16px;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e6b28a;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s;
            background: rgba(255, 255, 255, 0.7);
            color: #5D2906;
        }

        .input-group input:focus, .input-group select:focus {
            border-color: #8B4513;
            outline: none;
            background: white;
        }

        /* Enhanced DateTime Picker Styles */
        .datetime-picker {
            background: linear-gradient(135deg, #f9f9f9, #f5f5f5);
            border-radius: 16px;
            padding: 20px;
            border: 2px solid #e6b28a;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(139, 69, 19, 0.1);
        }

        .datetime-picker:hover {
            border-color: #8B4513;
            box-shadow: 0 4px 20px rgba(139, 69, 19, 0.15);
        }

        .time-presets {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .time-presets {
                gap: 6px;
            }

            .preset-btn {
                padding: 6px 10px;
                font-size: 11px;
            }

            .input-row {
                flex-direction: column;
                gap: 12px;
            }

            .datetime-picker {
                padding: 16px;
            }
        }

        .preset-btn {
            background: linear-gradient(135deg, #8B4513, #A0522D);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .preset-btn:hover {
            background: linear-gradient(135deg, #A0522D, #CD853F);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.3);
        }

        .preset-btn:active {
            transform: translateY(0);
        }

        .date-input-container {
            margin-bottom: 16px;
        }

        .input-row {
            display: flex;
            gap: 16px;
        }

        .date-section, .time-section {
            flex: 1;
        }

        .mini-label {
            display: block;
            font-size: 11px;
            font-weight: 700;
            color: #8B4513;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .styled-date-input, .styled-time-input {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e6b28a;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
            color: #5D2906;
        }

        .styled-date-input:focus, .styled-time-input:focus {
            outline: none;
            border-color: #8B4513;
            background: white;
            box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1);
        }

        .selected-datetime {
            background: linear-gradient(135deg, #f5cac3, #f7d7d0);
            padding: 14px 16px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: #8B4513;
            border: 2px solid #e6b28a;
            transition: all 0.3s ease;
        }

        .selected-datetime:hover {
            border-color: #8B4513;
        }

        .selected-datetime i {
            color: #8B4513;
            font-size: 18px;
        }

        #selected-datetime-text {
            font-size: 15px;
            font-weight: 600;
        }

        /* Beautiful Calendar Styling */
        .calendar-section {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border: 2px solid #ffb6c1;
        }

        .calendar-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border: 2px solid #ffd1dc;
            overflow: hidden;
        }

        .calendar-header {
            background: linear-gradient(to right, #ffb6c1, #ff69b4);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #5D2906;
            font-weight: bold;
            border-radius: 15px 15px 0 0;
        }

        .calendar-nav {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            background: #8B4513;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        .nav-btn:hover {
            background: #5D2906;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 69, 19, 0.3);
        }

        .calendar-title {
            font-size: 1.4rem;
            text-align: center;
            flex-grow: 1;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: rgba(255, 182, 193, 0.3);
            padding: 10px 0;
            text-align: center;
            font-weight: bold;
            color: #8B4513;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
        }

        .day {
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            position: relative;
            color: #5D2906;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 182, 193, 0.3);
        }

        .day:hover {
            background: rgba(255, 182, 193, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }

        .day.other-month {
            color: #a0522d;
            opacity: 0.6;
        }

        .day.today {
            background: rgba(255, 182, 193, 0.4);
            color: #8B4513;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(255, 182, 193, 0.5);
        }

        .day.selected {
            background: #8B4513;
            color: white;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(139, 69, 19, 0.4);
        }

        .day.has-reminder:after {
            content: '';
            position: absolute;
            bottom: 5px;
            width: 6px;
            height: 6px;
            background: #ff6b6b;
            border-radius: 50%;
        }

        .calendar-footer {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-top: 1px solid #ffd1dc;
        }

        /* Action Buttons */
        .action-btn {
            display: inline-block;
            padding: 14px 25px;
            background: #8B4513;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .action-btn:hover {
            background: #5D2906;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(139, 69, 19, 0.3);
        }

        .action-btn.secondary {
            background: #ffb6c1;
            color: #5D2906;
        }

        .action-btn.secondary:hover {
            background: #ff69b4;
        }

        /* Reminder Cards */
        .reminder-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid;
            position: relative;
            transition: all 0.3s ease;
        }

        .reminder-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .reminder-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .reminder-title {
            font-size: 22px;
            color: #5D2906;
            font-weight: bold;
        }

        .reminder-actions button {
            background: none;
            border: none;
            cursor: pointer;
            margin-left: 10px;
            color: #8B4513;
            font-size: 18px;
            transition: all 0.3s;
        }

        .reminder-actions button:hover {
            transform: scale(1.2);
        }

        .reminder-description {
            color: #5D2906;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .reminder-details {
            display: flex;
            gap: 20px;
            color: #8B4513;
            font-size: 15px;
        }

        .reminder-details div {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Footer */
        .app-footer {
            text-align: center;
            padding: 20px;
            color: #8B4513;
            font-size: 18px;
            background: rgba(255, 255, 255, 0.8);
            width: 100%;
            position: relative;
            margin-top: 20px;
            border-top: 2px solid rgba(255, 182, 193, 0.4);
        }

        /* Responsive design */
        @media (max-width: 1100px) {
            .reminders-container {
                margin: 30px 20px;
                padding: 25px;
            }

            .navbar {
                padding: 0 20px;
            }

            .nav-links {
                gap: 15px;
            }

            .nav-links a {
                font-size: 16px;
                padding: 6px 10px;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                height: 60px;
                padding: 0 15px;
            }

            .logo-text {
                font-size: 20px;
            }

            .nav-links {
                gap: 10px;
            }

            .nav-links a {
                font-size: 14px;
                padding: 5px 8px;
            }

            .reminders-container h2 {
                font-size: 26px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .reminder-details {
                flex-direction: column;
                gap: 10px;
            }

            .calendar-title {
                font-size: 1.2rem;
            }

            .day {
                height: 40px;
                font-size: 0.9rem;
            }
        }
    </style>
    <style>
        /* Micro-interactions (non-invasive) */
        .btn, .action-btn, .nav-btn { position: relative; overflow: hidden; -webkit-tap-highlight-color: transparent; }
        .btn:active, .action-btn:active, .nav-btn:active { transform: translateY(0) scale(0.98); }
        .nav-links a i, .action-btn i, .btn i { transition: transform 0.2s ease; }
        .nav-links a:hover i { transform: translateY(-1px); }
        .input-group input:focus, .input-group select:focus { box-shadow: 0 0 0 3px rgba(255,182,193,0.35); }
        .ripple { position: absolute; border-radius: 999px; transform: translate(-50%,-50%) scale(0);
            background: rgba(255,255,255,0.5); pointer-events: none; animation: ripple 600ms ease-out forwards; }
        @keyframes ripple { from { opacity:.7; transform: translate(-50%,-50%) scale(0);} to { opacity:0; transform: translate(-50%,-50%) scale(4);} }
        @media (prefers-reduced-motion: reduce) { * { animation-duration: .001ms !important; animation-iteration-count: 1 !important; transition-duration: .001ms !important; } }
    </style>

</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="logo">
            <div class="logo-icon">🧸</div>
            <div class="logo-text">Buddy</div>
        </div>
        <div class="nav-links">
            <a href="index.html"><i class="fas fa-home"></i> Home</a>
            <a href="diary.html"><i class="fas fa-book"></i> Diary</a>
            <a href="reminders.html" class="active"><i class="fas fa-bell"></i> Reminders</a>
            <a href="calendar.html"><i class="fas fa-calendar"></i> Calendar</a>
            <a href="settings.html"><i class="fas fa-cog"></i> Settings</a>
            <a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </nav>

    <!-- Reminders Container -->
    <div class="reminders-container">
        <h2>
            <i class="fas fa-bell"></i> Smart Reminders
        </h2>

        <!-- Create Reminder Form -->
        <div class="create-reminder">
            <h3><i class="fas fa-plus-circle"></i> Create New Reminder</h3>
            <div class="form-grid">
                <div class="input-group">
                    <label for="reminder-title">Title</label>
                    <input type="text" id="reminder-title" placeholder="Reminder title">
                </div>

                <div class="input-group">
                    <label for="reminder-desc">Description</label>
                    <input type="text" id="reminder-desc" placeholder="Description (optional)">
                </div>

                <div class="input-group">
                    <label for="reminder-date">Date & Time</label>
                    <div class="datetime-picker">
                        <!-- Quick presets -->
                        <div class="time-presets">
                            <button type="button" class="preset-btn" data-preset="now">Now</button>
                            <button type="button" class="preset-btn" data-preset="1hour">In 1 Hour</button>
                            <button type="button" class="preset-btn" data-preset="tomorrow">Tomorrow 9 AM</button>
                            <button type="button" class="preset-btn" data-preset="weekend">This Weekend</button>
                        </div>

                        <!-- Date input with better styling -->
                        <div class="date-input-container">
                            <div class="input-row">
                                <div class="date-section">
                                    <label class="mini-label">Date</label>
                                    <input type="date" id="reminder-date-only" class="styled-date-input">
                                </div>
                                <div class="time-section">
                                    <label class="mini-label">Time</label>
                                    <input type="time" id="reminder-time-only" class="styled-time-input">
                                </div>
                            </div>
                        </div>

                        <!-- Hidden datetime-local for compatibility -->
                        <input type="datetime-local" id="reminder-date" style="display: none;">

                        <!-- Selected datetime display -->
                        <div class="selected-datetime">
                            <i class="fas fa-calendar-alt"></i>
                            <span id="selected-datetime-text">Select date and time</span>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label for="reminder-prealert">Pre-alert (minutes)</label>
                    <input type="number" id="reminder-prealert" value="15" min="0">
                </div>

                <div class="input-group">
                    <label for="reminder-color">Color</label>
                    <select id="reminder-color">
                        <option value="#ff6b6b">Red</option>
                        <option value="#51cf66">Green</option>
                        <option value="#339af0">Blue</option>
                        <option value="#ff922b">Orange</option>
                        <option value="#cc5de8">Purple</option>
                        <option value="#ffb6c1">Pink</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="reminder-recurring">Recurrence</label>
                    <select id="reminder-recurring">
                        <option value="none">None</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
            </div>

            <button class="action-btn" id="save-reminder-btn">
                <i class="fas fa-save"></i> Create Reminder
            </button>
        </div>

        <!-- Beautiful Calendar -->
        <div class="calendar-section">
            <h3><i class="fas fa-calendar-alt"></i> Calendar View</h3>
            <div class="calendar-container">
                <div class="calendar-header">
                    <div class="calendar-nav">
                        <button class="nav-btn" id="prev-month"><i class="fas fa-chevron-left"></i></button>
                    </div>
                    <div class="calendar-title" id="current-month">August 2025</div>
                    <div class="calendar-nav">
                        <button class="nav-btn" id="next-month"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>

                <div class="weekdays">
                    <div>Sun</div>
                    <div>Mon</div>
                    <div>Tue</div>
                    <div>Wed</div>
                    <div>Thu</div>
                    <div>Fri</div>
                    <div>Sat</div>
                </div>

                <div class="days-grid" id="calendar-days">
                    <!-- Calendar days will be generated by JavaScript -->
                </div>

                <div class="calendar-footer">
                    <button class="action-btn secondary" id="clear-btn">
                        <i class="fas fa-times"></i> Clear
                    </button>
                    <button class="action-btn" id="today-btn">
                        <i class="fas fa-calendar-check"></i> Today
                    </button>
                </div>
            </div>
        </div>

        <!-- Upcoming Reminders -->
        <div class="upcoming-reminders">
            <h3><i class="fas fa-list"></i> Upcoming Reminders</h3>
            <div id="reminders-list">
                <!-- Reminders will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="app-footer">
        Made with LOVE | by SAJANI KUMARI 💞🫶🏻
    </footer>

    <!-- Include config.js for API configuration -->
    <script src="js/config.js"></script>

    <script>
        // Authentication check
        function checkAuthentication() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');

            if (!token || !user) {
                alert('Please login to access reminders.');
                window.location.href = 'index.html';
                return false;
            }
            return true;
        }

        // Check authentication on page load
        if (!checkAuthentication()) {
            // Page will redirect, stop execution
        } else {
            // DOM Elements
            const saveReminderBtn = document.getElementById('save-reminder-btn');
            const remindersList = document.getElementById('reminders-list');
            const calendarDays = document.getElementById('calendar-days');
            const currentMonthEl = document.getElementById('current-month');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const todayBtn = document.getElementById('today-btn');
        const clearBtn = document.getElementById('clear-btn');

        // Reminders data - now integrated with backend
        let reminders = [];

        // Utility functions
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function capitalizeFirst(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function showLoadingState(message = 'Loading...') {
            const loadingEl = document.getElementById('loading-indicator') || createLoadingIndicator();
            loadingEl.textContent = message;
            loadingEl.style.display = 'block';
        }

        function hideLoadingState() {
            const loadingEl = document.getElementById('loading-indicator');
            if (loadingEl) {
                loadingEl.style.display = 'none';
            }
        }

        function createLoadingIndicator() {
            const loadingEl = document.createElement('div');
            loadingEl.id = 'loading-indicator';
            loadingEl.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: rgba(139, 69, 19, 0.9);
                color: white;
                padding: 12px 20px;
                border-radius: 20px;
                font-weight: 500;
                z-index: 1000;
                box-shadow: 0 4px 20px rgba(0,0,0,0.1);
                display: none;
            `;
            document.body.appendChild(loadingEl);
            return loadingEl;
        }

        function showErrorMessage(message, type = 'error') {
            const errorEl = document.getElementById('error-message') || createErrorMessageElement();
            errorEl.textContent = message;
            errorEl.className = `error-message ${type}`;
            errorEl.style.display = 'block';
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                errorEl.style.display = 'none';
            }, 5000);
        }

        function createErrorMessageElement() {
            const errorEl = document.createElement('div');
            errorEl.id = 'error-message';
            errorEl.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 20px;
                font-weight: 500;
                z-index: 1000;
                box-shadow: 0 4px 20px rgba(0,0,0,0.1);
                display: none;
                max-width: 300px;
            `;
            document.body.appendChild(errorEl);
            return errorEl;
        }

        // API helper functions
        async function apiRequest(url, options = {}) {
            const token = localStorage.getItem('token');
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            };

            const response = await fetch(`${getApiUrl('/reminders')}${url}`, {
                ...defaultOptions,
                ...options,
                headers: { ...defaultOptions.headers, ...options.headers }
            });

            if (!response.ok) {
                throw new Error(`API Error: ${response.status} ${response.statusText}`);
            }

            return response.json();
        }

        // Load reminders from backend
        async function loadReminders() {
            showLoadingState('Loading reminders...');
            try {
                console.log('📡 Loading reminders from backend...');
                const response = await apiRequest('');
                
                // Extract reminders from response.data (backend returns {success, message, data})
                reminders = response.data || response || [];
                console.log('✅ Loaded', reminders.length, 'reminders from backend');
                console.log('📋 Reminders data:', reminders);

                // Also save to localStorage as backup
                localStorage.setItem('innerself_reminders', JSON.stringify(reminders));

                hideLoadingState();
                renderReminders();
                renderCalendar(currentMonth, currentYear);
            } catch (error) {
                console.error('❌ Failed to load reminders from backend:', error);
                hideLoadingState();

                // Fallback to localStorage
                console.log('📱 Falling back to localStorage...');
                reminders = JSON.parse(localStorage.getItem('innerself_reminders')) || [];
                console.log('📱 Loaded', reminders.length, 'reminders from localStorage');

                // Show user-friendly error message
                showErrorMessage('Unable to sync with server. Showing offline data.', 'warning');

                renderReminders();
                renderCalendar(currentMonth, currentYear);
            }
        }

        // Save reminder to backend
        async function saveReminderToBackend(reminderData) {
            try {
                console.log('📡 Saving reminder to backend:', reminderData.title);
                const response = await apiRequest('', {
                    method: 'POST',
                    body: JSON.stringify(reminderData)
                });
                
                // Extract reminder from response.data (backend returns {success, message, data})
                const savedReminder = response.data || response;
                console.log('✅ Reminder saved to backend:', savedReminder);
                return savedReminder;
            } catch (error) {
                console.error('❌ Failed to save reminder to backend:', error);
                throw error;
            }
        }

        // Update reminder in backend
        async function updateReminderInBackend(reminderId, reminderData) {
            try {
                console.log('📡 Updating reminder in backend:', reminderId);
                const response = await apiRequest(`/${reminderId}`, {
                    method: 'PUT',
                    body: JSON.stringify(reminderData)
                });
                
                // Extract reminder from response.data (backend returns {success, message, data})
                const updatedReminder = response.data || response;
                console.log('✅ Reminder updated in backend:', updatedReminder);
                return updatedReminder;
            } catch (error) {
                console.error('❌ Failed to update reminder in backend:', error);
                throw error;
            }
        }

        // Delete reminder from backend
        async function deleteReminderFromBackend(reminderId) {
            try {
                console.log('📡 Deleting reminder from backend:', reminderId);
                await apiRequest(`/${reminderId}`, {
                    method: 'DELETE'
                });
                console.log('✅ Reminder deleted from backend');
            } catch (error) {
                console.error('❌ Failed to delete reminder from backend:', error);
                throw error;
            }
        }

        // Calendar state
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();

        // Initialize the page
        async function initPage() {
            renderCalendar(currentMonth, currentYear);
            setToday();
            initDateTimePicker();

            // Load reminders from backend
            await loadReminders();
        }

        // Initialize enhanced datetime picker
        function initDateTimePicker() {
            const dateInput = document.getElementById('reminder-date-only');
            const timeInput = document.getElementById('reminder-time-only');
            const hiddenDatetime = document.getElementById('reminder-date');
            const selectedText = document.getElementById('selected-datetime-text');

            // Set default time to current time + 1 hour
            const now = new Date();
            const defaultTime = new Date(now.getTime() + 60 * 60 * 1000); // +1 hour

            dateInput.value = formatDateOnly(defaultTime);
            timeInput.value = formatTimeOnly(defaultTime);
            updateHiddenDateTime();
            updateSelectedText();

            // Event listeners for date/time inputs
            dateInput.addEventListener('change', () => {
                updateHiddenDateTime();
                updateSelectedText();
            });

            timeInput.addEventListener('change', () => {
                updateHiddenDateTime();
                updateSelectedText();
            });

            // Preset buttons
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const preset = btn.dataset.preset;
                    applyPreset(preset);
                });
            });

            function updateHiddenDateTime() {
                if (dateInput.value && timeInput.value) {
                    hiddenDatetime.value = `${dateInput.value}T${timeInput.value}`;
                }
            }

            function updateSelectedText() {
                if (dateInput.value && timeInput.value) {
                    const selectedDate = new Date(`${dateInput.value}T${timeInput.value}`);
                    const formattedDate = selectedDate.toLocaleDateString('en-US', {
                        weekday: 'short',
                        month: 'short',
                        day: 'numeric',
                        year: 'numeric'
                    });
                    const formattedTime = selectedDate.toLocaleTimeString('en-US', {
                        hour: 'numeric',
                        minute: '2-digit',
                        hour12: true
                    });
                    selectedText.textContent = `${formattedDate} at ${formattedTime}`;
                } else {
                    selectedText.textContent = 'Select date and time';
                }
            }

            function applyPreset(preset) {
                const now = new Date();
                let targetDate;

                switch (preset) {
                    case 'now':
                        targetDate = now;
                        break;
                    case '1hour':
                        targetDate = new Date(now.getTime() + 60 * 60 * 1000);
                        break;
                    case 'tomorrow':
                        targetDate = new Date(now);
                        targetDate.setDate(now.getDate() + 1);
                        targetDate.setHours(9, 0, 0, 0);
                        break;
                    case 'weekend':
                        targetDate = new Date(now);
                        const daysUntilSaturday = (6 - now.getDay()) % 7;
                        targetDate.setDate(now.getDate() + (daysUntilSaturday || 7));
                        targetDate.setHours(10, 0, 0, 0);
                        break;
                }

                dateInput.value = formatDateOnly(targetDate);
                timeInput.value = formatTimeOnly(targetDate);
                updateHiddenDateTime();
                updateSelectedText();
            }
        }

        function formatDateOnly(date) {
            return date.toISOString().split('T')[0];
        }

        function formatTimeOnly(date) {
            return date.toTimeString().slice(0, 5);
        }

        // Render the calendar
        function renderCalendar(month, year) {
            // Clear existing days
            calendarDays.innerHTML = '';

            // Set current month display
            currentMonthEl.textContent = new Date(year, month).toLocaleString('default', {
                month: 'long',
                year: 'numeric'
            });

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1);
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Get the day of the week for the first day (0 = Sunday, 1 = Monday, etc)
            const firstDayIndex = firstDay.getDay();

            // Get the number of days from the previous month to show
            const daysFromPrevMonth = firstDayIndex;

            // Get the last day of the previous month
            const prevMonthLastDay = new Date(year, month, 0).getDate();

            // Days from next month to show
            const daysFromNextMonth = 42 - (daysInMonth + daysFromPrevMonth); // 6 rows x 7 days

            // Previous month days
            for (let i = daysFromPrevMonth - 1; i >= 0; i--) {
                const day = prevMonthLastDay - i;
                const dayElement = document.createElement('div');
                dayElement.className = 'day other-month';
                dayElement.textContent = day;
                dayElement.addEventListener('click', () => {
                    // Change to previous month when clicking on a day from previous month
                    currentMonth--;
                    if (currentMonth < 0) {
                        currentMonth = 11;
                        currentYear--;
                    }
                    renderCalendar(currentMonth, currentYear);
                });
                calendarDays.appendChild(dayElement);
            }

            // Current month days
            const today = new Date();
            for (let i = 1; i <= daysInMonth; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'day';
                dayElement.textContent = i;

                // Check if this is today
                if (i === today.getDate() &&
                    month === today.getMonth() &&
                    year === today.getFullYear()) {
                    dayElement.classList.add('today');
                }

                // Check if this day has reminders (with better error handling)
                const hasReminder = Array.isArray(reminders) && reminders.some(reminder => {
                    try {
                        if (!reminder || !reminder.datetime) return false;
                        const reminderDate = new Date(reminder.datetime);
                        return !isNaN(reminderDate.getTime()) && 
                               reminderDate.getDate() === i &&
                               reminderDate.getMonth() === month &&
                               reminderDate.getFullYear() === year;
                    } catch (error) {
                        console.warn('Error checking reminder date:', error);
                        return false;
                    }
                });

                if (hasReminder) {
                    dayElement.classList.add('has-reminder');
                }

                // Add click event to select date
                dayElement.addEventListener('click', () => {
                    // Remove selection from other days
                    document.querySelectorAll('.day.selected').forEach(d => {
                        d.classList.remove('selected');
                    });

                    // Add selection to clicked day
                    dayElement.classList.add('selected');

                    // Update the new datetime inputs
                    const selectedDate = new Date(year, month, i);
                    const dateInput = document.getElementById('reminder-date-only');
                    const timeInput = document.getElementById('reminder-time-only');
                    const hiddenDatetime = document.getElementById('reminder-date');
                    const selectedText = document.getElementById('selected-datetime-text');

                    // Set date, keep current time or set to 9 AM if no time selected
                    dateInput.value = formatDateOnly(selectedDate);
                    if (!timeInput.value) {
                        timeInput.value = '09:00';
                    }

                    // Update hidden input and display
                    hiddenDatetime.value = `${dateInput.value}T${timeInput.value}`;

                    const displayDate = new Date(`${dateInput.value}T${timeInput.value}`);
                    const formattedDate = displayDate.toLocaleDateString('en-US', {
                        weekday: 'short',
                        month: 'short',
                        day: 'numeric',
                        year: 'numeric'
                    });
                    const formattedTime = displayDate.toLocaleTimeString('en-US', {
                        hour: 'numeric',
                        minute: '2-digit',
                        hour12: true
                    });
                    selectedText.textContent = `${formattedDate} at ${formattedTime}`;
                });

                calendarDays.appendChild(dayElement);
            }

            // Next month days
            for (let i = 1; i <= daysFromNextMonth; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'day other-month';
                dayElement.textContent = i;
                dayElement.addEventListener('click', () => {
                    // Change to next month when clicking on a day from next month
                    currentMonth++;
                    if (currentMonth > 11) {
                        currentMonth = 0;
                        currentYear++;
                    }
                    renderCalendar(currentMonth, currentYear);
                });
                calendarDays.appendChild(dayElement);
            }
        }

        // Format date for datetime-local input
        function formatDateForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        // Set today as default
        function setToday() {
            const today = new Date();
            const oneHourLater = new Date(today.getTime() + 60 * 60 * 1000);

            const dateInput = document.getElementById('reminder-date-only');
            const timeInput = document.getElementById('reminder-time-only');
            const hiddenDatetime = document.getElementById('reminder-date');
            const selectedText = document.getElementById('selected-datetime-text');

            dateInput.value = formatDateOnly(oneHourLater);
            timeInput.value = formatTimeOnly(oneHourLater);
            hiddenDatetime.value = formatDateForInput(oneHourLater);

            const formattedDate = oneHourLater.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
            const formattedTime = oneHourLater.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
            selectedText.textContent = `${formattedDate} at ${formattedTime}`;

            // Select today in calendar
            const todayElement = document.querySelector('.day.today');
            if (todayElement) {
                document.querySelectorAll('.day.selected').forEach(d => {
                    d.classList.remove('selected');
                });
                todayElement.classList.add('selected');
            }
        }

        // Render reminders list
        function renderReminders() {
            remindersList.innerHTML = '';

            // Check if reminders array is valid and has items
            if (!Array.isArray(reminders) || reminders.length === 0) {
                const noRemindersEl = document.createElement('div');
                noRemindersEl.className = 'no-reminders-message';
                noRemindersEl.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #8B4513;">
                        <i class="fas fa-bell-slash" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">No reminders yet</h3>
                        <p>Create your first reminder using the form above</p>
                    </div>
                `;
                remindersList.appendChild(noRemindersEl);
                return;
            }

            // Sort reminders by date
            const sortedReminders = [...reminders].sort((a, b) =>
                new Date(a.datetime) - new Date(b.datetime)
            );

            sortedReminders.forEach(reminder => {
                const datetime = new Date(reminder.datetime);
                const now = new Date();
                const isPast = datetime < now;

                const reminderEl = document.createElement('div');
                reminderEl.className = `reminder-card ${isPast ? 'past' : 'upcoming'}`;
                reminderEl.style.borderLeftColor = reminder.color;

                // Handle both _id (MongoDB) and id formats for consistency
                const reminderId = reminder._id || reminder.id;
                
                // Ensure proper datetime formatting
                const formattedDateTime = datetime.toLocaleDateString('en-US', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
                
                reminderEl.innerHTML = `
                    <div class="reminder-header">
                        <div class="reminder-title">${escapeHtml(reminder.title)}</div>
                        <div class="reminder-actions">
                            <button class="edit-reminder" data-id="${reminderId}" title="Edit reminder">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-reminder" data-id="${reminderId}" title="Delete reminder">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="reminder-description">${escapeHtml(reminder.description || '')}</div>
                    <div class="reminder-details">
                        <div><i class="fas fa-clock"></i> ${formattedDateTime}</div>
                        ${reminder.recurring !== 'none' ?
                          `<div><i class="fas fa-sync-alt"></i> ${capitalizeFirst(reminder.recurring)}</div>` : ''}
                        <div><i class="fas fa-bell"></i> ${reminder.preAlert || 15} min before</div>
                    </div>
                `;

                remindersList.appendChild(reminderEl);
            });

            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-reminder').forEach(button => {
                button.addEventListener('click', function() {
                    const reminderId = this.getAttribute('data-id');
                    editReminder(reminderId);
                });
            });

            document.querySelectorAll('.delete-reminder').forEach(button => {
                button.addEventListener('click', function() {
                    const reminderId = this.getAttribute('data-id');
                    deleteReminder(reminderId);
                });
            });
        }

        // Create new reminder
        async function createReminder() {
            console.log('📝 Creating new reminder...');

            const title = document.getElementById('reminder-title').value;
            const description = document.getElementById('reminder-desc').value;
            const datetime = document.getElementById('reminder-date').value;
            const preAlert = document.getElementById('reminder-prealert').value;
            const color = document.getElementById('reminder-color').value;
            const recurring = document.getElementById('reminder-recurring').value;

            console.log('📋 Reminder form data:', {
                title,
                description,
                datetime,
                preAlert,
                color,
                recurring
            });

            if (!title || !datetime) {
                showErrorMessage('Please fill in title and select date/time', 'error');
                return;
            }

            // Validate datetime is not in the past (allow up to 1 minute ago for edge cases)
            const selectedDate = new Date(datetime);
            const now = new Date();
            if (selectedDate < new Date(now.getTime() - 60000)) {
                showErrorMessage('Please select a future date and time', 'error');
                return;
            }

            const reminderData = {
                title: title.trim(),
                description: description.trim(),
                datetime,
                preAlert: parseInt(preAlert) || 15,
                color: color || '#ff6b6b',
                recurring: recurring || 'none'
            };

            showLoadingState('Creating reminder...');
            try {
                console.log('📡 Sending reminder to backend:', reminderData);

                // Save to backend first
                const savedReminder = await saveReminderToBackend(reminderData);

                console.log('✅ Reminder saved to backend:', savedReminder);

                // Add to local array with backend ID
                reminders.push(savedReminder);

                // Update localStorage backup
                localStorage.setItem('innerself_reminders', JSON.stringify(reminders));

                renderReminders();
                renderCalendar(currentMonth, currentYear);

                // Reset form
                document.getElementById('reminder-title').value = '';
                document.getElementById('reminder-desc').value = '';
                document.getElementById('reminder-date-only').value = '';
                document.getElementById('reminder-time-only').value = '';
                document.getElementById('reminder-date').value = '';
                document.getElementById('selected-datetime-text').textContent = 'Select date and time';
                document.getElementById('reminder-prealert').value = '15';
                document.getElementById('reminder-color').value = '#ff6b6b';
                document.getElementById('reminder-recurring').value = 'none';

                hideLoadingState();
                showErrorMessage('Reminder created successfully!', 'success');
            } catch (error) {
                hideLoadingState();
                console.error('Failed to create reminder:', error);
                showErrorMessage('Failed to create reminder. Please check your connection and try again.', 'error');
            }
        }

        // Edit reminder
        function editReminder(reminderId) {
            const reminder = reminders.find(r => r._id === reminderId || r.id === reminderId);
            if (!reminder) {
                console.error('Reminder not found:', reminderId);
                return;
            }

            // Populate form
            document.getElementById('reminder-title').value = reminder.title;
            document.getElementById('reminder-desc').value = reminder.description;

            // Parse datetime for new inputs
            const reminderDate = new Date(reminder.datetime);
            document.getElementById('reminder-date-only').value = formatDateOnly(reminderDate);
            document.getElementById('reminder-time-only').value = formatTimeOnly(reminderDate);
            document.getElementById('reminder-date').value = reminder.datetime;

            // Update selected datetime display
            const formattedDate = reminderDate.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
            const formattedTime = reminderDate.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
            document.getElementById('selected-datetime-text').textContent = `${formattedDate} at ${formattedTime}`;

            document.getElementById('reminder-prealert').value = reminder.preAlert;
            document.getElementById('reminder-color').value = reminder.color;
            document.getElementById('reminder-recurring').value = reminder.recurring;

            // Change button to update
            saveReminderBtn.innerHTML = '<i class="fas fa-save"></i> Update Reminder';
            saveReminderBtn.onclick = () => updateReminder(reminderId);

            // Scroll to form
            document.querySelector('.create-reminder').scrollIntoView({ behavior: 'smooth' });
        }

        // Update reminder
        async function updateReminder(reminderId) {
            const title = document.getElementById('reminder-title').value;
            const description = document.getElementById('reminder-desc').value;
            const datetime = document.getElementById('reminder-date').value;
            const preAlert = document.getElementById('reminder-prealert').value;
            const color = document.getElementById('reminder-color').value;
            const recurring = document.getElementById('reminder-recurring').value;

            if (!title || !datetime) {
                showErrorMessage('Please fill in title and select date/time', 'error');
                return;
            }

            // Validate datetime is not in the past
            const selectedDate = new Date(datetime);
            const now = new Date();
            if (selectedDate < new Date(now.getTime() - 60000)) {
                showErrorMessage('Please select a future date and time', 'error');
                return;
            }

            showLoadingState('Updating reminder...');
            try {
                const reminderData = {
                    title: title.trim(),
                    description: description.trim(),
                    datetime,
                    preAlert: parseInt(preAlert) || 15,
                    color: color || '#ff6b6b',
                    recurring: recurring || 'none'
                };

                // Update in backend first
                const updatedReminder = await updateReminderInBackend(reminderId, reminderData);

                // Update local array
                const index = reminders.findIndex(r => r._id === reminderId || r.id === reminderId);
                if (index !== -1) {
                    reminders[index] = {
                        ...reminders[index],
                        ...updatedReminder
                    };

                    localStorage.setItem('innerself_reminders', JSON.stringify(reminders));
                    renderReminders();
                    renderCalendar(currentMonth, currentYear);

                    // Reset form and button
                    document.getElementById('reminder-title').value = '';
                    document.getElementById('reminder-desc').value = '';
                    document.getElementById('reminder-date-only').value = '';
                    document.getElementById('reminder-time-only').value = '';
                    document.getElementById('reminder-date').value = '';
                    document.getElementById('selected-datetime-text').textContent = 'Select date and time';
                    document.getElementById('reminder-prealert').value = '15';
                    document.getElementById('reminder-color').value = '#ff6b6b';
                    document.getElementById('reminder-recurring').value = 'none';

                    saveReminderBtn.innerHTML = '<i class="fas fa-save"></i> Create Reminder';
                    saveReminderBtn.onclick = createReminder;

                    hideLoadingState();
                    showErrorMessage('Reminder updated successfully!', 'success');
                }
            } catch (error) {
                hideLoadingState();
                console.error('Failed to update reminder:', error);
                showErrorMessage('Failed to update reminder. Please check your connection and try again.', 'error');
            }
        }

        // Delete reminder
        async function deleteReminder(reminderId) {
            if (!confirm('Are you sure you want to delete this reminder?')) return;

            showLoadingState('Deleting reminder...');
            try {
                // Delete from backend first
                await deleteReminderFromBackend(reminderId);

                // Remove from local array (handle both _id and id formats)
                reminders = reminders.filter(r => {
                    const id = r._id || r.id;
                    return id !== reminderId;
                });

                // Update localStorage backup
                localStorage.setItem('innerself_reminders', JSON.stringify(reminders));

                renderReminders();
                renderCalendar(currentMonth, currentYear);
                
                hideLoadingState();
                showErrorMessage('Reminder deleted successfully!', 'success');
            } catch (error) {
                hideLoadingState();
                console.error('Failed to delete reminder:', error);
                showErrorMessage('Failed to delete reminder. Please check your connection and try again.', 'error');
            }
        }

        // Event Listeners
        saveReminderBtn.addEventListener('click', createReminder);

        prevMonthBtn.addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar(currentMonth, currentYear);
        });

        nextMonthBtn.addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar(currentMonth, currentYear);
        });

        todayBtn.addEventListener('click', () => {
            currentDate = new Date();
            currentMonth = currentDate.getMonth();
            currentYear = currentDate.getFullYear();
            renderCalendar(currentMonth, currentYear);
            setToday();
        });

        clearBtn.addEventListener('click', () => {
            document.getElementById('reminder-title').value = '';
            document.getElementById('reminder-desc').value = '';
            document.getElementById('reminder-prealert').value = '15';
            document.getElementById('reminder-color').value = '#ff6b6b';

        // Subtle ripple binding
        (function(){
            const rippleTargets = document.querySelectorAll('.btn, .action-btn, .nav-btn');
            rippleTargets.forEach(btn => btn.addEventListener('click', function(e){
                const r = this.getBoundingClientRect();
                const x = (e.clientX||r.width/2) - r.left;
                const y = (e.clientY||r.height/2) - r.top;
                const s = document.createElement('span'); s.className='ripple';
                const size = Math.max(r.width, r.height);
                s.style.width = s.style.height = size + 'px'; s.style.left = x + 'px'; s.style.top = y + 'px';
                this.appendChild(s); s.addEventListener('animationend', ()=> s.remove());
            }));
        })();

            document.getElementById('reminder-recurring').value = 'none';
            setToday();
        });

        // Logout functionality
        document.getElementById('logout-btn').addEventListener('click', function() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        });

        // Initialize the page
        initPage();

        } // End of authentication check
    </script>
</body>
</html>
